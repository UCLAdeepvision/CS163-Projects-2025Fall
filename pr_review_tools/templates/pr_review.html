<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR å®¡æŸ¥å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            text-align: center;
        }
        
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-card .label {
            color: #6c757d;
            margin-top: 5px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .status-box {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }
        
        .status-box.idle { background: #e9ecef; }
        .status-box.preparing { background: #fff3cd; }
        .status-box.starting_docker { background: #fff3cd; }
        .status-box.docker_ready { background: #d1ecf1; }
        .status-box.accepted { background: #d4edda; }
        .status-box.skipped { background: #f8d7da; }
        .status-box.error { background: #f8d7da; }
        .status-box.conflict { background: #f8d7da; }
        .status-box.no_valid_files { background: #f8d7da; }
        
        .current-pr {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .preview-link {
            display: inline-block;
            margin: 15px 0;
            padding: 15px 25px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .preview-link:hover {
            background: #5568d3;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-accept {
            background: #28a745;
            color: white;
        }
        
        .btn-accept:hover:not(:disabled) {
            background: #218838;
        }
        
        .btn-skip {
            background: #dc3545;
            color: white;
        }
        
        .btn-skip:hover:not(:disabled) {
            background: #c82333;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
        }
        
        .pr-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .pr-item {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pr-item:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }
        
        .pr-item.active {
            border-color: #667eea;
            background: #e7f1ff;
        }
        
        .pr-number {
            font-weight: bold;
            color: #667eea;
        }
        
        .pr-title {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .pr-meta {
            font-size: 12px;
            color: #6c757d;
        }
        
        .edit-section {
            margin: 20px 0;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 2px solid #667eea;
            display: none;
        }
        
        .edit-section.active {
            display: block;
        }
        
        .edited-file-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: #d4edda;
            border-radius: 5px;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Pull Request å®¡æŸ¥å·¥å…·</h1>
            <p>äº¤äº’å¼PRå®¡æŸ¥ä¸åˆå¹¶ç³»ç»Ÿ</p>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="number" id="stat-total">0</div>
                    <div class="label">æ€»PRæ•°</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="stat-reviewed">0</div>
                    <div class="label">å·²å®¡æŸ¥</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="stat-accepted">0</div>
                    <div class="label">å·²æ¥å—</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="stat-skipped">0</div>
                    <div class="label">å·²è·³è¿‡</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="refreshPRs()" title="ä»GitHubé‡æ–°åŠ è½½å¼€æ”¾çš„PRï¼ˆå·²å…³é—­çš„PRè‡ªåŠ¨è¿‡æ»¤ï¼‰">ğŸ”„ åˆ·æ–°PRåˆ—è¡¨</button>
                <button class="btn btn-secondary" onclick="restartDocker()">ğŸ³ é‡å¯Docker</button>
            </div>
            
            <div style="margin-top: 10px; padding: 10px; background: #d1ecf1; border-radius: 5px; font-size: 13px; border-left: 4px solid #17a2b8;">
                <strong>ğŸ’¡ åˆ—è¡¨ç®¡ç†ï¼š</strong>
                <ul style="margin: 5px 0 0 20px; padding: 0;">
                    <li>æ¥å—PR â†’ ä»åˆ—è¡¨ç§»é™¤</li>
                    <li>è·³è¿‡PR â†’ ä¿ç•™åœ¨åˆ—è¡¨</li>
                    <li>åˆ·æ–°åˆ—è¡¨ â†’ åªæ˜¾ç¤ºå¼€æ”¾çš„PR</li>
                </ul>
            </div>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“‹ PR åˆ—è¡¨</h2>
                <div class="pr-list" id="pr-list">
                    <p style="text-align: center; color: #6c757d;">åŠ è½½ä¸­...</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>âš™ï¸ å®¡æŸ¥æ§åˆ¶</h2>
                
                <div id="status-box" class="status-box idle">
                    <strong>çŠ¶æ€ï¼š</strong> <span id="status-text">ç­‰å¾…é€‰æ‹©PR</span>
                    <div id="status-message" style="margin-top: 10px;"></div>
                </div>
                
                <div id="current-pr-info" style="display: none;">
                    <div class="current-pr">
                        <div><strong>å½“å‰PR #<span id="current-pr-number"></span></strong></div>
                        <div id="current-pr-title"></div>
                        <div style="margin-top: 5px; font-size: 12px; color: #6c757d;">
                            <span id="current-pr-author"></span> Â· 
                            <span id="current-pr-branch"></span>
                        </div>
                    </div>
                    
                    <div id="preview-section" style="display: none;">
                        <a id="preview-link" href="" target="_blank" class="preview-link">
                            ğŸŒ åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é¢„è§ˆç½‘ç«™
                        </a>
                        <p style="margin-top: 10px; color: #6c757d; font-size: 14px;">
                            è¯·åœ¨é¢„è§ˆç½‘ç«™ä¸­æ£€æŸ¥PRçš„å†…å®¹ã€‚
                        </p>
                    </div>
                    
                    <!-- Additional Comment Section -->
                    <div style="margin: 20px 0;">
                        <label style="display: block; font-weight: bold; margin-bottom: 8px;">
                            ğŸ’¬ Additional Comment (optional)
                        </label>
                        <textarea id="additional-comment" 
                            style="width: 100%; min-height: 100px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Segoe UI', sans-serif; resize: vertical; font-size: 14px; line-height: 1.6;"
                            placeholder="æ·»åŠ é¢å¤–çš„å®¡æŸ¥æ„è§...ï¼ˆä¼šé™„åŠ åˆ°è‡ªåŠ¨ç”Ÿæˆçš„è‹±æ–‡è¯„è®ºåé¢ï¼‰"></textarea>
                    </div>
                    
                    <!-- Edit Mode Section -->
                    <div id="edit-section" class="edit-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <strong style="font-size: 16px;">âœï¸ Edit Mode - Active</strong>
                                <p style="color: #6c757d; font-size: 13px; margin-top: 5px;">
                                    åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­ç¼–è¾‘ assets/ å’Œ _posts/ ä¸‹çš„æ–‡ä»¶ï¼Œå®Œæˆåç‚¹å‡» Finish Edit
                                </p>
                            </div>
                            <button class="btn btn-primary" onclick="finishEdit()" style="flex: 0 0 auto; max-width: 150px;">
                                âœ“ Finish Edit
                            </button>
                        </div>
                        
                        <div id="edited-files-display">
                            <strong style="font-size: 14px;">ä¿®æ”¹çš„æ–‡ä»¶ï¼š</strong>
                            <div id="edited-files-list" style="margin-top: 10px;">
                                <p style="color: #6c757d; font-style: italic;">ç‚¹å‡» Finish Edit æ£€æµ‹ä¿®æ”¹çš„æ–‡ä»¶</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="btn-start-edit" class="btn btn-primary" onclick="startEdit()" disabled>
                            âœï¸ Start Edit
                        </button>
                        <button id="btn-accept" class="btn btn-accept" onclick="acceptPR()" disabled>
                            âœ… æ¥å—å¹¶åˆå¹¶ï¼ˆæœ¬åœ°ï¼‰
                        </button>
                        <button id="btn-skip" class="btn btn-skip" onclick="skipPR()" disabled>
                            â­ï¸ è·³è¿‡
                        </button>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 12px; background: #d4edda; border-radius: 5px; font-size: 13px; border-left: 4px solid #28a745;">
                        <strong>âœ… è‡ªåŠ¨åŒ–æµç¨‹ï¼š</strong> æ¥å—PRåç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
                        <ul style="margin: 8px 0 0 20px; padding: 0;">
                            <li>åˆå¹¶åˆ°æœ¬åœ°mainåˆ†æ”¯</li>
                            <li>å‘å¸ƒå®¡æŸ¥æŠ¥å‘Šåˆ°GitHub</li>
                            <li><strong>å…³é—­GitHub PR</strong></li>
                            <li><strong>è‡ªåŠ¨pushåˆ°è¿œç¨‹ä»“åº“</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentPRIndex = null;
        let statusCheckInterval = null;
        let isEditMode = false;
        let editedFiles = [];
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadPRs();
            startStatusPolling();
        };
        
        // åŠ è½½PRåˆ—è¡¨
        function loadPRs() {
            fetch('/api/prs')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayPRs(data.prs);
                        updateStats(data.stats);
                    }
                })
                .catch(error => console.error('Error loading PRs:', error));
        }
        
        // æ˜¾ç¤ºPRåˆ—è¡¨
        function displayPRs(prs) {
            const prList = document.getElementById('pr-list');
            if (prs.length === 0) {
                prList.innerHTML = '<p style="text-align: center; color: #6c757d;">æ²¡æœ‰æ‰¾åˆ°PR</p>';
                return;
            }
            
            prList.innerHTML = '';
            prs.forEach(pr => {
                const item = document.createElement('div');
                item.className = 'pr-item';
                item.onclick = () => selectPR(pr.index);
                item.innerHTML = `
                    <div class="pr-number">PR #${pr.number}</div>
                    <div class="pr-title">${pr.title}</div>
                    <div class="pr-meta">
                        ğŸ‘¤ ${pr.author} | ğŸ”€ ${pr.branch}
                    </div>
                `;
                prList.appendChild(item);
            });
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats(stats) {
            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-reviewed').textContent = stats.reviewed;
            document.getElementById('stat-accepted').textContent = stats.accepted;
            document.getElementById('stat-skipped').textContent = stats.skipped;
        }
        
        // é€‰æ‹©PR
        function selectPR(index) {
            // é«˜äº®é€‰ä¸­çš„PR
            document.querySelectorAll('.pr-item').forEach((item, i) => {
                item.classList.toggle('active', i === index - 1);
            });
            
            currentPRIndex = index;
            isEditMode = false;
            editedFiles = [];
            document.getElementById('edit-section').classList.remove('active');
            document.getElementById('additional-comment').value = '';
            
            // å‡†å¤‡å®¡æŸ¥PR
            fetch('/api/prepare_pr', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({index: index})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('PR preparation started');
                }
            })
            .catch(error => console.error('Error preparing PR:', error));
        }
        
        // å¼€å§‹çŠ¶æ€è½®è¯¢
        function startStatusPolling() {
            if (statusCheckInterval) clearInterval(statusCheckInterval);
            statusCheckInterval = setInterval(updateStatus, 1000);
        }
        
        // æ›´æ–°çŠ¶æ€
        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateStatusDisplay(data);
                    }
                })
                .catch(error => console.error('Error updating status:', error));
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay(data) {
            const statusBox = document.getElementById('status-box');
            const statusText = document.getElementById('status-text');
            const statusMessage = document.getElementById('status-message');
            const currentPRInfo = document.getElementById('current-pr-info');
            const previewSection = document.getElementById('preview-section');
            const btnAccept = document.getElementById('btn-accept');
            const btnSkip = document.getElementById('btn-skip');
            const btnStartEdit = document.getElementById('btn-start-edit');
            
            // æ›´æ–°çŠ¶æ€æ¡†æ ·å¼
            statusBox.className = 'status-box ' + data.status;
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            const statusTexts = {
                'idle': 'ç­‰å¾…é€‰æ‹©PR',
                'preparing': 'æ­£åœ¨å‡†å¤‡å®¡æŸ¥...',
                'starting_docker': 'æ­£åœ¨å¯åŠ¨Docker...',
                'docker_ready': 'âœ… å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å®¡æŸ¥',
                'accepting': 'æ­£åœ¨æ¥å—å¹¶åˆå¹¶...',
                'accepted': 'âœ… å·²æˆåŠŸåˆå¹¶',
                'skipped': 'â­ï¸ å·²è·³è¿‡',
                'error': 'âŒ å‘ç”Ÿé”™è¯¯',
                'conflict': 'âš ï¸ å‘ç°åˆå¹¶å†²çª',
                'no_valid_files': 'âŒ æ— æœ‰æ•ˆæ–‡ä»¶ä¿®æ”¹'
            };
            statusText.textContent = statusTexts[data.status] || data.status;
            
            // æ›´æ–°æ¶ˆæ¯
            statusMessage.textContent = data.message || '';
            
            // æ˜¾ç¤º/éšè—å½“å‰PRä¿¡æ¯
            if (data.current_pr) {
                currentPRInfo.style.display = 'block';
                document.getElementById('current-pr-number').textContent = data.current_pr.number;
                document.getElementById('current-pr-title').textContent = data.current_pr.title;
                document.getElementById('current-pr-author').textContent = data.current_pr.author;
                document.getElementById('current-pr-branch').textContent = data.current_pr.branch;
                
                // æ˜¾ç¤º/éšè—é¢„è§ˆé“¾æ¥
                if (data.docker_running && data.status === 'docker_ready') {
                    previewSection.style.display = 'block';
                    document.getElementById('preview-link').href = data.preview_url;
                    
                    if (!isEditMode) {
                        btnAccept.disabled = false;
                        btnSkip.disabled = false;
                        btnStartEdit.disabled = false;
                    }
                } else {
                    previewSection.style.display = 'none';
                    btnAccept.disabled = true;
                    btnSkip.disabled = true;
                    btnStartEdit.disabled = true;
                }
            } else {
                currentPRInfo.style.display = 'none';
            }
            
            // å¦‚æœPRå·²å®Œæˆï¼Œè‡ªåŠ¨éšè—
            if (data.status === 'accepted' || data.status === 'skipped' || data.status === 'no_valid_files' || data.status === 'conflict') {
                setTimeout(() => {
                    currentPRInfo.style.display = 'none';
                    loadPRs(); // åˆ·æ–°PRåˆ—è¡¨
                }, 5000);
            }
        }
        
        // Start Edit Mode
        function startEdit() {
            // è·å–æ–‡ä»¶åˆ—è¡¨
            fetch('/api/get_files')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        isEditMode = true;
                        
                        // æ˜¾ç¤ºedit section
                        document.getElementById('edit-section').classList.add('active');
                        document.getElementById('btn-start-edit').style.display = 'none';
                        
                        // æ˜¾ç¤ºå¯ç¼–è¾‘æ–‡ä»¶åˆ—è¡¨
                        const fileList = data.files.join('\n- ');
                        
                        alert(`âœï¸ Edit Mode å·²å¼€å¯ï¼\n\nå¯ç¼–è¾‘çš„æ–‡ä»¶ï¼š\n- ${fileList}\n\nè¯·ä½¿ç”¨æ‚¨çš„ä»£ç ç¼–è¾‘å™¨ï¼ˆVS Code, Sublimeç­‰ï¼‰ç¼–è¾‘è¿™äº›æ–‡ä»¶ã€‚\n\nç¼–è¾‘å®Œæˆåç‚¹å‡» "Finish Edit" æŒ‰é’®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ‚¨çš„ä¿®æ”¹ã€‚`);
                    }
                })
                .catch(error => console.error('Error starting edit mode:', error));
        }
        
        // Finish Edit Mode
        function finishEdit() {
            // æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶å˜åŒ–ï¼ˆä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤ï¼‰
            fetch('/api/check_edited_files')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        editedFiles = data.edited_files || [];
                        const fileStatus = data.file_status || {};
                        
                        // æ˜¾ç¤ºä¿®æ”¹çš„æ–‡ä»¶
                        const container = document.getElementById('edited-files-list');
                        
                        if (editedFiles.length === 0) {
                            container.innerHTML = '<p style="color: #6c757d; font-style: italic;">æœªæ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–</p>';
                        } else {
                            let html = '';
                            let modifiedCount = 0;
                            let addedCount = 0;
                            let deletedCount = 0;
                            
                            editedFiles.forEach(file => {
                                const status = fileStatus[file] || 'modified';
                                let icon = '';
                                let color = '';
                                let label = '';
                                
                                if (status === 'added') {
                                    icon = 'â•';
                                    color = '#28a745';
                                    label = 'æ·»åŠ ';
                                    addedCount++;
                                } else if (status === 'deleted') {
                                    icon = 'â–';
                                    color = '#dc3545';
                                    label = 'åˆ é™¤';
                                    deletedCount++;
                                } else {
                                    icon = 'âœï¸';
                                    color = '#17a2b8';
                                    label = 'ä¿®æ”¹';
                                    modifiedCount++;
                                }
                                
                                html += `<div class="edited-file-item" style="background: ${color}15; border-left: 3px solid ${color};">
                                    <span style="margin-right: 8px;">${icon}</span>
                                    <strong style="color: ${color};">[${label}]</strong> ${file}
                                </div>`;
                            });
                            container.innerHTML = html;
                            
                            // ç”Ÿæˆè¯¦ç»†çš„æç¤ºä¿¡æ¯
                            let summary = `âœ“ æ£€æµ‹åˆ° ${editedFiles.length} ä¸ªæ–‡ä»¶å˜åŒ–ï¼\n\n`;
                            if (modifiedCount > 0) summary += `âœï¸  ä¿®æ”¹: ${modifiedCount} ä¸ª\n`;
                            if (addedCount > 0) summary += `â• æ·»åŠ : ${addedCount} ä¸ª\n`;
                            if (deletedCount > 0) summary += `â– åˆ é™¤: ${deletedCount} ä¸ª\n`;
                            summary += `\nè¿™äº›å˜åŒ–ä¼šåŒ…å«åœ¨åˆå¹¶ä¸­ï¼Œå¹¶åœ¨GitHubè¯„è®ºä¸­æ ‡æ³¨ã€‚`;
                            
                            alert(summary);
                        }
                    }
                })
                .catch(error => console.error('Error checking edited files:', error));
        }
        
        // æ¥å—PR
        function acceptPR() {
            // è·å–additional comment
            const additionalComment = document.getElementById('additional-comment').value.trim();
            
            let confirmMsg = 'ç¡®å®šè¦æ¥å—å¹¶åˆå¹¶è¿™ä¸ªPRå—ï¼Ÿ\n\nâœ… ç³»ç»Ÿå°†è‡ªåŠ¨ï¼š\n- åˆå¹¶åˆ°mainåˆ†æ”¯\n- å‘å¸ƒå®¡æŸ¥æŠ¥å‘Š\n- å…³é—­GitHub PR\n- æ¨é€åˆ°GitHubè¿œç¨‹ä»“åº“\n- PRä»åˆ—è¡¨ä¸­ç§»é™¤';
            
            if (editedFiles.length > 0) {
                confirmMsg += `\n\nåŒ…å« ${editedFiles.length} ä¸ªç¼–è¾‘çš„æ–‡ä»¶ã€‚`;
            }
            
            if (additionalComment) {
                confirmMsg += '\n\nåŒ…å«é¢å¤–çš„å®¡æŸ¥è¯„è®ºã€‚';
            }
            
            if (!confirm(confirmMsg)) return;
            
            fetch('/api/accept_pr', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    additional_comment: additionalComment
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Accepting PR:', data);
                // æ¸…ç©ºcommentå’Œedited files
                document.getElementById('additional-comment').value = '';
                editedFiles = [];
                isEditMode = false;
                document.getElementById('edit-section').classList.remove('active');
                document.getElementById('btn-start-edit').style.display = 'inline-block';
            })
            .catch(error => console.error('Error accepting PR:', error));
        }
        
        // è·³è¿‡PR
        function skipPR() {
            if (!confirm('ç¡®å®šè¦è·³è¿‡è¿™ä¸ªPRå—ï¼Ÿ')) return;
            
            fetch('/api/skip_pr', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                console.log('Skipping PR:', data);
                // æ¸…ç©ºçŠ¶æ€
                document.getElementById('additional-comment').value = '';
                editedFiles = [];
                isEditMode = false;
                document.getElementById('edit-section').classList.remove('active');
                document.getElementById('btn-start-edit').style.display = 'inline-block';
            })
            .catch(error => console.error('Error skipping PR:', error));
        }
        
        // åˆ·æ–°PRåˆ—è¡¨
        function refreshPRs() {
            fetch('/api/refresh_prs', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`âœ… ${data.message}`);
                    loadPRs();
                }
            })
            .catch(error => console.error('Error refreshing PRs:', error));
        }
        
        // é‡å¯Docker
        function restartDocker() {
            if (!confirm('ç¡®å®šè¦é‡å¯Dockerå—ï¼Ÿ')) return;
            
            fetch('/api/restart_docker', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                console.log('Restarting Docker:', data);
            })
            .catch(error => console.error('Error restarting Docker:', error));
        }
    </script>
</body>
</html>
